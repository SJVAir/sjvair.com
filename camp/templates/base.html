{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    {% if settings.GOOGLE_ANALYTICS_ID %}
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ settings.GOOGLE_ANALYTICS_ID }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ settings.GOOGLE_ANALYTICS_ID }}');
    </script>
    {% endif %}

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="SJVAir is a network of low-cost air quality monitors providing real-time PM2.5 data to disadvantaged communities across the San Joaquin Valley. SJVAir is operated by a collaborative of non-profit organizations from Bakersfield to Stockton.">

    <meta name="msapplication-TileColor" content="#3298dc">
    <meta name="theme-color" content="#3298dc">

    <title>{% block title %}SJVAir{% endblock %}</title>

    <link rel="icon" href="{% static 'img/favicon.ico' %}" />
    <!--[if IE]><link rel="shortcut icon" href="{% static 'img/favicon.ico' %}" /><![endif]-->

    <link type="text/css" rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-VhBcF/php0Z/P5ZxlxaEx1GwqTQVIBu4G4giRWxTKOCjTxsPFETUDdVL5B6vYvOt" crossorigin="anonymous">

    <style type="text/css">
        .goog-te-banner-frame {display:none !important;}
        body {top:0 !important;}
    </style>

    {% block extra-head %}{% endblock %}
</head>
<body class="{% block body-class %}{% endblock %}">

<nav class="navbar is-info" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-title" href="/">
                <span class="icon is-medium">
                    <span class="fal fa-lungs fa-lg"></span>
                </span>
                <span>SJVAir</span>
            </a>

            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="id_navbar-menu">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div class="navbar-menu" id="id_navbar-menu">
            <div class="navbar-end">
                <a href="/about/" class="navbar-item">About</a>
                <a href="/api/" class="navbar-item">API</a>
                <div class="navbar-item">
                    <div id="google_translate_element"></div>
                </div>
                <!-- <div class="navbar-item notranslate" translate="no">
                    <div class="dropdown is-hoverable">
                        <div class="dropdown-trigger">
                            <button class="button is-size-7" aria-haspopup="true" aria-controls="dropdown-language">
                                <span class="icon is-small">
                                    <span class="far fa-language has-text-grey-light" aria-hidden="true"></span>
                                </span>
                                <span>Select Language</span>
                                <span class="icon is-small">
                                    <span class="fas fa-angle-down" aria-hidden="true"></span>
                                </span>
                            </button>
                        </div>
                        <div class="dropdown-menu" id="dropdown-language" role="menu">
                            <div class="dropdown-content">
                                <a href="#" onclick="translatePage('en'); return false;" class="dropdown-item">English</a>
                                <a href="#" onclick="translatePage('es'); return false;" class="dropdown-item">Spanish</a>
                                <a href="#" onclick="translatePage('tl'); return false;" class="dropdown-item">Filipino</a>
                                <a href="#" onclick="translatePage('hmn'); return false;" class="dropdown-item">Hmong</a>
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>
        </div>
    </div>
</nav>

<div class="main">
    {% block main %}
    <div class="content">
        {% block messages %}
            {% for message in messages %}
                <article class="message is-{{ message.tags }}">
                    <div class="message-header">
                        <button class="delete" aria-label="delete"></button>
                    </div>
                    <div class="message-body">{{ message|safe }}</div>
                </article>
            {% endfor %}
        {% endblock %}
        {% block content %}{% endblock %}
    </div>
    {% endblock %}
</div>

</body>

{% if settings.SENTRY_DSN_CLIENT %}
<script type="text/javascript" src="https://cdn.ravenjs.com/3.12.1/raven.min.js"></script>
<script type="text/javascript">
    Raven.config('{{ settings.SENTRY_DSN_CLIENT }}', {
        release: '{{ settings.COMMIT_HASH }}'
    }).install();
</script>
{% endif %}

<script type="text/javascript" src="{% static 'js/main.js' %}"></script>
{% block javascripts %}{% endblock %}

<!-- Translation -->
<script type="text/javascript">
function googleTranslateElementInit() {
    new google.translate.TranslateElement({
        autoDisplay: false,
        pageLanguage: 'en',
        includedLanguages: 'en,es,hmn,tl',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google_translate_element');
}
</script>
<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<script type="text/javascript">
function FireEvent(element, eventName) {
    try {
        if(document.createEvent) {
            var event = document.createEvent("HTMLEvents");
            event.initEvent(eventName, true, true);
            element.dispatchEvent(event);
        } else {
            var event = document.createEventObject();
            element.fireEvent(`on${eventName}`, event)
        }
    }
    catch(e){
        console.log('FireEvent', e);
    }
}

function translatePage(language){
    if(language.value) language = language.value;
    // if(language == '') language = 'en';
    console.log('selected:', language)
    var combo = document.getElementsByClassName('goog-te-combo')[0];
    var gte = document.getElementById('google_translate_element');

    if(!gte || !gte.innerHTML.length || !combo.length || !combo.innerHTML.length){
        setTimeout(() => {
            translatePage(language);
        }, 500);
    } else {
        if(combo.value == language) {
            return;
        }
        combo.value = language;
        FireEvent(combo, 'change');
        // FireEvent(combo, 'change');
    }
}
</script>

</html>
