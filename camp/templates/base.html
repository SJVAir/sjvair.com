{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    {% if settings.GOOGLE_ANALYTICS_ID %}
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ settings.GOOGLE_ANALYTICS_ID }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ settings.GOOGLE_ANALYTICS_ID }}');
    </script>
    {% endif %}

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="SJVAir is a network of low-cost air quality monitors providing real-time PM2.5 data to disadvantaged communities across the San Joaquin Valley. SJVAir is operated by a collaborative of non-profit organizations from Bakersfield to Stockton.">

    <meta name="msapplication-config" content="{% static 'img/favicon/browserconfig.xml' %}">
    <meta name="msapplication-TileColor" content="#3298dc">
    <meta name="theme-color" content="#3298dc">

    <title>{% block title %}SJVAir{% endblock %}</title>

    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/favicon/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'img/favicon/site.webmanifest' %}">
    <link rel="icon" href="{% static 'img/favicon/favicon.ico' %}" />
    <!--[if IE]><link rel="shortcut icon" href="{% static 'img/favicon/favicon.ico' %}" /><![endif]-->

    <link type="text/css" rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-rqn26AG5Pj86AF4SO72RK5fyefcQ/x32DNQfChxWvbXIyXFePlEktwD18fEz+kQU" crossorigin="anonymous">

    {% block extra-head %}{% endblock %}
</head>
<body class="{% block body-class %}{% endblock %}">

<nav class="navbar is-white" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item" href="/">
                <img src="{% static 'img/sjvair.svg' %}" alt="SJVAir" />
            </a>

            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="id_navbar-menu">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div class="navbar-menu" id="id_navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item" href="/alerts/">Air Alerts</a>
                <div class="navbar-item has-dropdown is-hoverable">
                    <a class="navbar-link">Resources</a>
                    <div class="navbar-dropdown">
                        <a class="navbar-item" href="/guidelines/">Outdoor Activity Guidelines</a>

                        <a class="navbar-item" href="{% static 'docs/Wildfire-Smoke-Preparedness-2021.pdf' %}">
                            <span>Wildfire Smoke Preparedness</span>
                            <span class="icon">
                                <span class="far fa-fw fa-file-pdf"></span>
                            </span>
                        </a>
                    </div>
                </div>
                <a class="navbar-item" href="/about/">About Us</a>
                <!-- <a href="/api/" class="navbar-item">Developers</a> -->
            </div>
            <div class="navbar-end">
                <div class="navbar-item">
                    <div class="field">
                        <div class="control has-icons-left">
                            <div class="select is-small">
                                <select id="id_translate" onchange="setLanguage(this.value);">
                                    {% for code, name in settings.LANGUAGES %}
                                    <option value="{{ code }}">{{ name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <span class="icon is-left has-text-grey-light">
                                <span class="fas fa-language"></span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="navbar-item is-hidden">
                    <div id="google_translate_element"></div>
                </div>
                {% if user.is_authenticated %}
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link">{{ user.email }}</a>
                        <div class="navbar-dropdown">
                            <a href="{% url 'account:profile' %}" class="navbar-item">
                                <span class="icon is-small">
                                    <span class="far fa-fw fa-user"></span>
                                </span>
                                <span>&nbsp; Your Profile</span>
                            </a>
                            <a href="{% url 'account:alerts' %}" class="navbar-item">
                                <span class="icon is-small">
                                    <span class="far fa-fw fa-sensor-alert"></span>
                                </span>
                                <span>&nbsp; Air Quality Alerts</span>
                            </a>
                            <a href="{% url 'account:subscriptions' %}" class="navbar-item">
                                <span class="icon is-small">
                                    <span class="far fa-fw fa-shield-check"></span>
                                </span>
                                <span>&nbsp; Monitor Subscriptions</span>
                            </a>
                            <a href="{% url 'account:password-change' %}" class="navbar-item">
                                <span class="icon is-small">
                                    <span class="muted far fa-fw fa-lock"></span>
                                </span>
                                <span>&nbsp; Change password</span>
                            </a>
                            <hr class="navbar-divider">
                            <a href="{% url 'account:logout' %}" class="navbar-item">
                                <span class="icon is-small">
                                    <span class="far fa-fw fa-sign-out-alt"></span>
                                </span>
                                <span>&nbsp;Logout</span>
                            </a>
                        </div>
                    </div>
                {% else %}

                {% endif %}
            </div>
        </div>
    </div>
</nav>

<div class="main">
    {% block main %}
    <div class="content">
        {% block messages %}
            {% for message in messages %}
                <article class="message is-{{ message.tags }}">
                    <div class="message-header">
                        <button class="delete" aria-label="delete"></button>
                    </div>
                    <div class="message-body">{{ message|safe }}</div>
                </article>
            {% endfor %}
        {% endblock %}
        {% block content %}{% endblock %}
    </div>
    {% endblock %}
</div>
</body>

{% if settings.SENTRY_DSN_CLIENT %}
<script type="text/javascript" src="https://cdn.ravenjs.com/3.12.1/raven.min.js"></script>
<script type="text/javascript">
    Raven.config('{{ settings.SENTRY_DSN_CLIENT }}', {
        release: '{{ settings.COMMIT_HASH }}'
    }).install();
</script>
{% endif %}

<script type="text/javascript" src="{% static 'js/main.js' %}"></script>
{% block javascripts %}{% endblock %}

<script type="text/javascript">
    function setLanguage(language){
        console.log('setLanguage', language);

        let $select = document.getElementById('id_translate'),
            $goog = document.querySelector('select.goog-te-combo');

        if(language == 'en' && ($goog.value == 'en' || $goog.value == '')){
            $select.value = 'en';
            return;
        }

        if($select.value != language){
            $select.value = language;
        }
        doGTranslate('en|' + language);
    }

    function googleTranslateElementInit() {
        new google.translate.TranslateElement({
            autoDisplay: false,
            pageLanguage: 'en',
            includedLanguages: 'en,es,hmn,tl',
        }, 'google_translate_element');

        let $select = document.getElementById('id_translate'),
            $goog = document.querySelector('select.goog-te-combo');

        // Keep the select up to date with the google select
        $goog.addEventListener('change', function(){
            let $select = document.getElementById('id_translate');
            console.log('goog.changed', this.value, $select.value);
            if($select.value != this.value){
                $select.value = this.value ? this.value : 'en';
            }
        });

        setTimeout(function(){
            let $select = document.getElementById('id_translate'),
                $goog = document.querySelector('select.goog-te-combo');
            $select.value = $goog.value ? $goog.value : "en";

            {% if user.is_authenticated %}
                setLanguage('{{ user.language }}');
            {% endif %}
        }, 1000);
    }
</script>

<script type="text/javascript">
// via gtranslate.io
/* <![CDATA[ */
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('6 7(a,b){n{4(2.9){3 c=2.9("o");c.p(b,f,f);a.q(c)}g{3 c=2.r();a.s(\'t\'+b,c)}}u(e){}}6 h(a){4(a.8)a=a.8;4(a==\'\')v;3 b=a.w(\'|\')[1];3 c;3 d=2.x(\'y\');z(3 i=0;i<d.5;i++)4(d[i].A==\'B-C-D\')c=d[i];4(2.j(\'k\')==E||2.j(\'k\').l.5==0||c.5==0||c.l.5==0){F(6(){h(a)},G)}g{c.8=b;7(c,\'m\');7(c,\'m\')}}',43,43,'||document|var|if|length|function|GTranslateFireEvent|value|createEvent||||||true|else|doGTranslate||getElementById|google_translate_element|innerHTML|change|try|HTMLEvents|initEvent|dispatchEvent|createEventObject|fireEvent|on|catch|return|split|getElementsByTagName|select|for|className|goog|te|combo|null|setTimeout|500'.split('|'),0,{}))
/* ]]> */
</script>

<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

</html>
